---
name: éœ€è¦ä¼˜åŒ–çš„åœºæ™¯
route: /example
---

import { Playground } from 'docz';
import Example from '../example/Example';

## ä»£ç 

ç”±äº Context çš„ç‰¹æ€§ï¼Œåœ¨ä¸‹é¢è¿™ç§åœºæ™¯ä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨ç”¨ useMemo è¿›è¡Œä¼˜åŒ–ã€‚

è¯¦è§ https://zh-hans.reactjs.org/docs/context.html#contextprovider  

> å½“ Provider çš„ value å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå†…éƒ¨çš„æ‰€æœ‰æ¶ˆè´¹ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ã€‚Provider åŠå…¶å†…éƒ¨ consumer ç»„ä»¶éƒ½ä¸å—åˆ¶äº shouldComponentUpdate å‡½æ•°ï¼Œå› æ­¤å½“ consumer ç»„ä»¶åœ¨å…¶ç¥–å…ˆç»„ä»¶é€€å‡ºæ›´æ–°çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ›´æ–°

```tsx
import React, { useState, useCallback } from 'react';
import { Card, Button, Input } from 'antd';
import { connect, useStore } from './store';
import './index.css';
import 'antd/dist/antd.css';

let addLogHack = (val: string) => {};

function Count() {
  const {
    state: { count },
    dispatch,
  } = useStore();
  // åŒæ­¥çš„add
  const add = useCallback(() => dispatch({ type: 'add' }), []);

  addLogHack('è®¡æ•°å™¨ç»„ä»¶é‡æ–°æ¸²æŸ“ğŸš€');

  return (
    <Card hoverable style={{ marginBottom: 24 }}>
      <h1>è®¡æ•°å™¨</h1>
      <div className="chunk">
        <div className="chunk">storeä¸­çš„countç°åœ¨æ˜¯ {count}</div>
        <Button onClick={add}>add</Button>
      </div>
    </Card>
  );
}

function Chat() {
  const {
    state: { message },
    dispatch,
  } = useStore();
  const [value, setValue] = useState('');

  addLogHack('èŠå¤©å®¤ç»„ä»¶é‡æ–°æ¸²æŸ“ğŸ’');

  const onChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    dispatch({
      type: 'chat',
      payload: e.target.value,
    });
  };

  return (
    <Card hoverable style={{ marginBottom: 24 }}>
      <h1>èŠå¤©å®¤</h1>
      å½“å‰æ¶ˆæ¯æ˜¯: {message}
      <Input onChange={onChange} placeholder="è¯·è¾“å…¥æ¶ˆæ¯" />
    </Card>
  );
}

function Logger() {
  const [logs, setLogs] = useState<string[]>([]);
  addLogHack = (log: string) => setLogs(prevLogs => [log, ...prevLogs]);
  return (
    <Card hoverable>
      <h1>æ§åˆ¶å°</h1>
      <div className="logs">
        {logs.map((log, idx) => (
          <p className="log" key={idx}>
            {log}
          </p>
        ))}
      </div>
    </Card>
  );
}

export default connect(() => {
  return (
    <div className="flex">
      <div className="left">
        <div className="count">
          <Count />
        </div>
        <div className="chat">
          <Chat />
        </div>
      </div>
      <div className="right">
        <Logger />
      </div>
    </div>
  );
});
```

### æ•ˆæœ

<Playground>
  <Example />
</Playground>

### ä¼˜åŒ–æ–¹æ¡ˆ

```tsx
function Chat() {
  const {
    state: { message },
    dispatch,
  } = useStore();

  const onChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    dispatch({
      type: 'chat',
      payload: e.target.value,
    });
  };

  return React.useMemo(
    () => {
      addLogHack('èŠå¤©å®¤ç»„ä»¶é‡æ–°æ¸²æŸ“ğŸ’');
      return (
        <Card hoverable style={{ marginBottom: 24 }}>
          <h1>èŠå¤©å®¤</h1>
          å½“å‰æ¶ˆæ¯æ˜¯: {message}
          <Input onChange={onChange} placeholder="è¯·è¾“å…¥æ¶ˆæ¯" />
        </Card>
      )
    },
    [message],
  )
}
```

æ³¨æ„è¿™ç§ä¼˜åŒ–ä¸‹ï¼Œ`Chat`ç»„ä»¶è¿˜ä¼šé‡æ–°è¿è¡Œï¼Œä½†æ˜¯returnçš„jsxåœ¨`message`ä¸å‘ç”Ÿæ”¹å˜çš„æƒ…å†µä¸‹ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæœ‰è€—è´¹æ€§èƒ½çš„reconcileræµç¨‹äº†ã€‚
